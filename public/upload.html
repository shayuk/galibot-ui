<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>העלאת PDF לחומרי קורס</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f0f4f8;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    form {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      width: 300px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    input, label, button {
      font-size: 1rem;
    }
    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
    }
    .success {
      color: green;
      margin-top: 10px;
    }
    .error {
      color: red;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <form id="uploadForm">
    <input type="hidden" name="email" value="shayuk@ariel.ac.il">

    <label>בחרי קובצי PDF:</label>
    <input type="file" name="pdf" accept="application/pdf" multiple required>

    <label>מקור / כותרת:</label>
    <input type="text" name="source" value="שיעור 1" required>

    <label>שם הקורס:</label>
    <input type="text" name="course_name" value="statistics" required>

    <button type="submit">העלאה</button>
    <div id="message"></div>
  </form>

  <script>
    const form = document.getElementById('uploadForm');
    const message = document.getElementById('message');

    form.addEventListener('submit', async (e) => {
      message.textContent = "";
      e.preventDefault();
      const formData = new FormData();
      const files = form.querySelector('input[name="pdf"]').files;
      const email = form.querySelector('input[name="email"]').value;
      const source = form.querySelector('input[name="source"]').value;
      const course = form.querySelector('input[name="course_name"]').value;

      for (const file of files) {
        formData.set('email', email);
        formData.set('source', source);
        formData.set('course_name', course);
        formData.set('pdf', file);

        try {
          const res = await fetch('https://lecturers-gpt-server.onrender.com/api/upload-course-material', {
            method: 'POST',
            body: formData
          });
          const data = await res.json();
          if (res.ok) {
            message.textContent += `\n✔ ${file.name}: ${data.chunks_saved} קטעים נשמרו.`;
            message.className = 'success';
          } else {
            message.textContent += `\n❌ ${file.name}: שגיאה – ${data.error || 'קרתה תקלה'}`;
            message.className = 'error';
          }
        } catch (err) {
          message.textContent += `\n❌ ${file.name}: שגיאה בתקשורת עם השרת.`;
          message.className = 'error';
        }
      }
    });
  </script>
</body>
</html>
